import{f as I,h as O,i as P,r as l,R as ie,j as e,B as r,T as o,C as se,F as f,n as le}from"./index-TH8YGKRz.js";import{E as ce}from"./Edit-CoZH97Fq.js";import{P as de}from"./PhotoCamera-BvYurExR.js";import{r as z}from"./createSvgIcon-B0Pm_6cI.js";import{A as H,D as ue}from"./AdminSidebar-Bc6icHTo.js";import{s as M,c as S,t as w}from"./tokens-DkKdY8jA.js";import{g as xe}from"./avatarService-BCG4JWCu.js";import{P as x}from"./Paper-Mdtt8qvf.js";import{A as he}from"./Avatar-BgeWc8dC.js";import{B as h}from"./Button-CJZqiG46.js";import{I as fe}from"./IconButton-BAp8iDOQ.js";import{D as ge,a as me,b as pe,c as je}from"./DialogTitle-CKHsR478.js";import{T as ve}from"./TextField-Du34Z7EL.js";import"./createSvgIcon-1GfyKPJS.js";import"./useControlled-BLQOo7Av.js";import"./Menu-CzX3FVwN.js";import"./resolveComponentProps-CAz9EWAT.js";import"./Divider-7QTrz6EV.js";import"./getThemeProps-DA88l0eV.js";import"./useSlot-B20WKvL2.js";var g={},L;function ye(){if(L)return g;L=1;var t=I();Object.defineProperty(g,"__esModule",{value:!0}),g.default=void 0;var i=t(z()),s=O();return g.default=(0,i.default)((0,s.jsx)("path",{d:"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2zm-2 0-8 5-8-5zm0 12H4V8l8 5 8-5z"}),"EmailOutlined"),g}var be=ye();const Se=P(be);var m={},J;function we(){if(J)return m;J=1;var t=I();Object.defineProperty(m,"__esModule",{value:!0}),m.default=void 0;var i=t(z()),s=O();return m.default=(0,i.default)((0,s.jsx)("path",{d:"M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79zm9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75zM7.5 3H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1-1.24 0-2.45-.2-3.57-.57-.1-.04-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.45-5.15-3.76-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1"}),"PhoneOutlined"),m}var Ie=we();const Oe=P(Ie);var p={},B;function Pe(){if(B)return p;B=1;var t=I();Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var i=t(z()),s=O();return p.default=(0,i.default)((0,s.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7-.25c.22 0 .41.1.55.25.12.13.2.31.2.5 0 .41-.34.75-.75.75s-.75-.34-.75-.75c0-.19.08-.37.2-.5.14-.15.33-.25.55-.25M19 19H5V5h14zM12 6c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3m0 4c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-6 6.47V18h12v-1.53c0-2.5-3.97-3.58-6-3.58s-6 1.07-6 3.58M8.31 16c.69-.56 2.38-1.12 3.69-1.12s3.01.56 3.69 1.12z"}),"AssignmentIndOutlined"),p}var ze=Pe();const Ce=P(ze);var j={},V;function Re(){if(V)return j;V=1;var t=I();Object.defineProperty(j,"__esModule",{value:!0}),j.default=void 0;var i=t(z()),s=O();return j.default=(0,i.default)((0,s.jsx)("path",{d:"m17 8-1.41 1.41L17.17 11H9v2h8.17l-1.58 1.58L17 16l4-4zM5 5h7V3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7v-2H5z"}),"LogoutOutlined"),j}var Ae=Re();const ke=P(Ae),Xe=()=>{const[t,i]=l.useState(null),[s,E]=l.useState(!0),[v,N]=l.useState(""),[$,y]=l.useState(!1),[u,C]=l.useState(""),[R,W]=l.useState(!1),[A,T]=l.useState(!1),[b,k]=l.useState(null),[G,F]=l.useState(null),_=ie.useRef(null),q=JSON.parse(localStorage.getItem("user")||"{}");l.useEffect(()=>{(async()=>{E(!0),N("");try{const c=await f("http://localhost:3000/api/users/me");if(!c.ok)throw new Error("Failed to fetch profile");const d=await c.json();i(d.data.user)}catch{N("Failed to load profile")}finally{E(!1)}})()},[]);const U=()=>{le()},Y=()=>{C((t==null?void 0:t.name)||""),y(!0)},K=async()=>{if(u.trim()){W(!0);try{if(!(await f("http://localhost:3000/api/users/me",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u.trim()})})).ok)throw new Error("Failed to update name");i({...t,name:u.trim()});const d={...JSON.parse(localStorage.getItem("user")||"{}"),name:u.trim()};localStorage.setItem("user",JSON.stringify(d)),y(!1),C("")}catch{alert("Failed to update name. Please try again.")}finally{W(!1)}}},Q=async()=>{if(window.confirm("Are you sure you want to deactivate your account? This action cannot be undone."))try{if(!(await f("http://localhost:3000/api/auth/deactivate",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to deactivate account");localStorage.clear(),window.location.href="/login"}catch{alert("Failed to deactivate account. Please try again.")}},X=async()=>{if(window.confirm("Are you sure you want to delete your account? This action is permanent and cannot be undone. Your account will be permanently deleted in 30 days."))try{if(!(await f("http://localhost:3000/api/auth/delete-account",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete account");alert("Account deletion requested. Your account will be permanently deleted in 30 days."),localStorage.clear(),window.location.href="/login"}catch{alert("Failed to delete account. Please try again.")}},Z=n=>{var D;const a=(D=n.target.files)==null?void 0:D[0];if(!a)return;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type)){alert("Please select a valid image file (JPEG, PNG, GIF, or WebP)");return}const d=2*1024*1024;if(a.size>d){alert("File size too large. Maximum size is 2MB");return}k(a),F(URL.createObjectURL(a))},ee=async()=>{if(b){T(!0);try{const n="http://localhost:3000",a=new FormData;a.append("avatar",b);const c=await f(`${n}/api/users/me/avatar`,{method:"POST",body:a});if(!c.ok){const ae=await c.json();throw new Error(ae.error||"Failed to upload avatar")}const d=await c.json();i({...t,avatarUrl:d.data.avatarUrl});const oe={...JSON.parse(localStorage.getItem("user")||"{}"),avatar:d.data.avatarUrl};localStorage.setItem("user",JSON.stringify(oe)),F(null),k(null),alert("Avatar uploaded successfully!")}catch(n){alert(n instanceof Error?n.message:"Failed to upload avatar. Please try again.")}finally{T(!1)}}},te=()=>{var n;(n=_.current)==null||n.click()},[re,ne]=l.useState(!1);return e.jsxs(r,{sx:{display:"flex",minHeight:"100vh",bgcolor:"#f7f8fa"},children:[e.jsx(r,{sx:{display:{xs:"none",md:"block"}},children:e.jsx(H,{userRole:q.role,currentTab:"profile",onSignOut:U})}),e.jsx(ue,{open:re,onClose:()=>ne(!1),PaperProps:{sx:{width:240}},children:e.jsx(H,{userRole:q.role,currentTab:"profile",onSignOut:U,isDrawer:!0})}),e.jsxs(r,{sx:{flex:1,display:"flex",flexDirection:"column",ml:{xs:0,md:"220px"}},children:[e.jsxs(r,{sx:{flex:1,px:M.pagePx,py:M.pagePy},children:[e.jsx(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsxs(r,{children:[e.jsx(o,{sx:{fontWeight:w.title.weight,fontSize:{xs:w.title.xs,md:w.title.md},color:S.textPrimary},children:"Profile"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(r,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:S.primary,opacity:.7}}),e.jsx(o,{sx:{color:S.textSecondary,fontSize:w.caption.size},children:(t==null?void 0:t.email)||""})]})]})}),s?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"40vh"},children:e.jsx(o,{children:"Loading profile..."})}):v?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"40vh"},children:e.jsx(o,{color:"error",children:v})}):null]}),!s&&!v&&e.jsx(x,{elevation:0,sx:{borderRadius:3,p:0,mb:4,overflow:"hidden",bgcolor:S.surfaceMuted},children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",py:5,position:"relative",minHeight:220},children:[e.jsxs(r,{sx:{position:"relative",width:140,height:140,mb:2},children:[e.jsx(he,{src:G||xe(t==null?void 0:t.avatarUrl),sx:{width:140,height:140,bgcolor:"#e6e6e6",fontSize:80},children:e.jsxs("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"8",r:"4",stroke:"#222",strokeWidth:"2"}),e.jsx("path",{d:"M4 20c0-4 4-7 8-7s8 3 8 7",stroke:"#222",strokeWidth:"2"})]})}),e.jsx(r,{onClick:te,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",bgcolor:"rgba(0,0,0,0.15)",borderRadius:"50%",transition:"background 0.2s","&:hover":{bgcolor:"rgba(0,0,0,0.25)"}},children:e.jsx(de,{sx:{color:"#fff",fontSize:32}})})]}),b&&e.jsxs(r,{sx:{mb:2,display:"flex",flexDirection:"column",alignItems:"center",gap:1},children:[e.jsxs(o,{sx:{color:"#666",fontSize:14},children:["Selected: ",b.name]}),e.jsxs(r,{sx:{display:"flex",gap:1},children:[e.jsx(h,{variant:"contained",size:"small",disabled:A,onClick:ee,sx:{bgcolor:"#2950DA",color:"#fff","&:hover":{bgcolor:"#526794"},"&:disabled":{bgcolor:"#ccc"}},children:A?e.jsxs(e.Fragment,{children:[e.jsx(se,{size:16,sx:{color:"#fff",mr:1}}),"Uploading..."]}):"Upload Avatar"}),e.jsx(h,{variant:"outlined",size:"small",disabled:A,onClick:()=>{k(null),F(null)},sx:{borderColor:"#666",color:"#666","&:hover":{borderColor:"#333",color:"#333"}},children:"Cancel"})]})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(o,{sx:{fontWeight:700,fontSize:22,color:"#222"},children:(t==null?void 0:t.name)||"N/A"}),e.jsx(fe,{onClick:Y,sx:{p:.5,color:"#2950DA","&:hover":{bgcolor:"rgba(41, 80, 218, 0.08)"}},children:e.jsx(ce,{sx:{fontSize:20}})})]}),e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:17,mb:2},children:(t==null?void 0:t.role)||"User"})]})}),!s&&!v&&e.jsxs(r,{sx:{maxWidth:600,mx:"auto",display:"flex",flexDirection:"column",gap:2,px:{xs:2,md:0}},children:[e.jsxs(x,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#F5F7FA",borderRadius:2},children:e.jsx(Se,{sx:{fontSize:32,color:"#888"}})}),e.jsxs(r,{sx:{flex:1,pl:2},children:[e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:16},children:"Email"}),e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:(t==null?void 0:t.email)||"N/A"})]})]}),e.jsxs(x,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#F5F7FA",borderRadius:2},children:e.jsx(Oe,{sx:{fontSize:32,color:"#888"}})}),e.jsxs(r,{sx:{flex:1,pl:2},children:[e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:16},children:"Phone No."}),e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:(t==null?void 0:t.phone)||"N/A"})]})]}),e.jsxs(x,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#F5F7FA",borderRadius:2},children:e.jsx(Ce,{sx:{fontSize:32,color:"#888"}})}),e.jsxs(r,{sx:{flex:1,pl:2},children:[e.jsx(o,{sx:{color:"#888",fontWeight:600,fontSize:16},children:"Admin Id"}),e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:(t==null?void 0:t.id)||"N/A"})]})]}),e.jsxs(x,{elevation:0,sx:{borderRadius:2,p:0,display:"flex",alignItems:"center",minHeight:64,cursor:"pointer","&:hover":{bgcolor:"#f7f8fa"}},onClick:U,children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#F5F7FA",borderRadius:2},children:e.jsx(ke,{sx:{fontSize:32,color:"#888"}})}),e.jsx(r,{sx:{flex:1,pl:2},children:e.jsx(o,{sx:{color:"#222",fontWeight:700,fontSize:17},children:"Log out"})})]}),e.jsxs(x,{elevation:0,sx:{borderRadius:2,p:0,mt:2,display:"flex",alignItems:"center",minHeight:64,background:"none",boxShadow:"none"},children:[e.jsx(r,{sx:{width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center",background:"none",borderRadius:2}}),e.jsxs(r,{sx:{flex:1,pl:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(h,{variant:"contained",sx:{bgcolor:"#526794",color:"#fff",fontWeight:700,borderRadius:2,textTransform:"none",fontSize:16,py:1.5,height:56,boxShadow:"0 2px 8px 0 rgba(44,62,80,0.04)",flex:1,"&:hover":{bgcolor:"#526794"}},onClick:Q,children:"Deactivate Account"}),e.jsx(h,{variant:"contained",sx:{bgcolor:"#dc3545",color:"#fff",fontWeight:700,borderRadius:2,textTransform:"none",fontSize:16,py:1.5,height:56,boxShadow:"0 2px 8px 0 rgba(44,62,80,0.04)",flex:1,"&:hover":{bgcolor:"#c82333"}},onClick:X,children:"Delete Account"})]})]})]})]}),e.jsxs(ge,{open:$,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(me,{sx:{fontWeight:700,color:"#222"},children:"Edit Name"}),e.jsx(pe,{children:e.jsx(ve,{autoFocus:!0,margin:"dense",label:"Name",type:"text",fullWidth:!0,value:u,onChange:n=>C(n.target.value),sx:{mt:1}})}),e.jsxs(je,{children:[e.jsx(h,{onClick:()=>y(!1),disabled:R,sx:{color:"#666"},children:"Cancel"}),e.jsx(h,{onClick:K,variant:"contained",disabled:R||!u.trim(),sx:{bgcolor:"#2950DA","&:hover":{bgcolor:"#526794"}},children:R?"Saving...":"Save"})]})]}),e.jsx("input",{type:"file",ref:_,onChange:Z,accept:"image/jpeg,image/png,image/gif,image/webp",style:{display:"none"}})]})};export{Xe as default};
